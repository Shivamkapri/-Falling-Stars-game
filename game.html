<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Catch the Falling Stars</title>
<style>
  /* Center page, set dark gradient background */
  html,body {
    height:100%; margin:0;
    background:linear-gradient(#00111a,#001b26);
    display:flex; align-items:center; justify-content:center;
    font-family:system-ui,Segoe UI,Roboto,Arial;
  }

  /* Wrap for canvas and HUD */
  #game-wrap { position:relative; }

  /* Main canvas style */
  canvas {
    display:block;
    background:linear-gradient(#021220,#052033);
    border:4px solid #0b3b55;
    box-shadow:0 8px 30px rgba(0,0,0,0.6);
    border-radius:6px;
  }

  /* HUD for score + high score */
  .hud {
    position:absolute; top:10px;
    font-weight:700; color:#fff;
    padding:6px 10px; border-radius:6px;
    background:rgba(0,0,0,0.25);
    font-family:monospace;
  }
  #score { left:10px; }
  #high { right:10px; }

  /* Overlay (start and game over screen) */
  #overlay {
    position:absolute; left:0; top:0;
    width:100%; height:100%;
    display:flex; align-items:center; justify-content:center;
    pointer-events:none;
  }
  .panel {
    pointer-events:auto;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.08);
    padding:18px 22px; border-radius:10px;
    color:#fff; text-align:center;
  }
  button {
    margin-top:12px; padding:8px 14px;
    border-radius:8px; border:none;
    background:#ffb74d; color:#2b1b00;
    font-weight:700; cursor:pointer;
  }
  button:hover {
    transform:translateY(-2px);
    box-shadow:0 6px 18px rgba(0,0,0,0.4);
  }
  small {
    display:block; color:#cde7ff; margin-top:6px; opacity:0.9;
  }
</style>
</head>
<body>
  <div id="game-wrap">
    <!-- Canvas where game is drawn -->
    <canvas id="game" width="800" height="600" tabindex="0"></canvas>

    <!-- HUD for live score and high score -->
    <div id="score" class="hud">Score: 0</div>
    <div id="high" class="hud">High: 0</div>

    <!-- Overlay for instructions and game over -->
    <div id="overlay">
      <div id="panel" class="panel">
        <h2 id="title">Catch the Falling Stars</h2>
        <p id="subtitle">Move with ← → keys. Catch stars for +1 point. 60 seconds.</p>
        <button id="startBtn">Start Game</button>
        <small>Difficulty increases every 15 seconds.</small>
      </div>
    </div>
  </div>

<script>
/* =======================
   GAME STATE VARIABLES
   ======================= */
const game = {
  canvas: document.getElementById('game'),
  ctx: null,
  width:800, height:600,
  stars: [],       // Array holding falling stars
  particles: [],   // Array for star-catching spark effects
  keys: {left:false,right:false}, // Player movement keys
  basket: {w:140,h:22,x:330,y:540,speed:500}, // Basket properties
  score:0,         // Player score
  high:0,          // Stored high score
  elapsed:0,       // Time since start
  remaining:60,    // Time left
  totalTime:60,    // Total game time
  running:false,   // Game running flag
  spawnTimer:0,    // Timer for spawning stars
  spawnInterval:0.5, // How often stars spawn (seconds)
  baseFallSpeed: 220, // Base falling speed of stars
  speedIncreaseStep: 60, // How much faster stars get per difficulty level
  difficultyLevel:0,    // Current difficulty level
  rafId:null            // requestAnimationFrame ID
};

/* Utility to keep values within bounds */
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

/* Setup the game */
function init(){
  game.ctx = game.canvas.getContext('2d');

  // Load saved high score
  const saved = parseInt(localStorage.getItem('cts_highscore')||'0',10);
  game.high = isNaN(saved)?0:saved;
  document.getElementById('high').textContent = 'High: ' + game.high;

  // Keyboard input handling
  window.addEventListener('keydown', e => {
    if(e.key==='ArrowLeft') game.keys.left=true;
    if(e.key==='ArrowRight') game.keys.right=true;
  });
  window.addEventListener('keyup', e => {
    if(e.key==='ArrowLeft') game.keys.left=false;
    if(e.key==='ArrowRight') game.keys.right=false;
  });

  // Start button click
  document.getElementById('startBtn').addEventListener('click', startGame);
}

/* Start the game loop */
function startGame(){
  // Reset game state
  game.stars = [];
  game.particles = [];
  game.score = 0;
  game.elapsed = 0;
  game.remaining = game.totalTime;
  game.spawnTimer = 0;
  game.difficultyLevel = 0;
  game.running = true;
  document.getElementById('score').textContent = 'Score: 0';
  document.getElementById('overlay').style.display = 'none';

  // Main game loop with delta time
  let last = performance.now();
  function frame(now){
    const dt = (now - last) / 1000;
    last = now;
    update(dt);
    draw();
    if(game.running) game.rafId = requestAnimationFrame(frame);
  }
  game.rafId = requestAnimationFrame(frame);
}

/* End the game and show final results */
function stopGame(){
  game.running = false;
  cancelAnimationFrame(game.rafId);

  // Save new high score if beaten
  if(game.score > game.high){
    game.high = game.score;
    localStorage.setItem('cts_highscore', String(game.high));
  }
  document.getElementById('high').textContent = 'High: ' + game.high;

  // Update overlay text
  document.getElementById('title').textContent = 'Time Up!';
  document.getElementById('subtitle').textContent = `You scored ${game.score}. High score: ${game.high}.`;
  document.getElementById('startBtn').textContent = 'Play Again';
  document.getElementById('overlay').style.display = 'flex';
}

/* Create a new falling star */
function spawnStar(){
  const r = 14 + Math.random()*8; // random size
  const x = r + Math.random()*(game.width - 2*r); // random position
  const fallSpeed = game.baseFallSpeed + game.difficultyLevel*game.speedIncreaseStep;
  game.stars.push({
    x, y: -r, r,
    vy: fallSpeed*(0.9+Math.random()*0.4), // small speed variation
    rot: Math.random()*Math.PI*2,
    rotSpeed: (Math.random()-0.5)*3 // random spin
  });
}

/* Spawn small particle effects when catching a star */
function spawnParticles(x,y){
  for(let i=0;i<8;i++){
    game.particles.push({
      x, y,
      vx:(Math.random()-0.5)*150,
      vy:(Math.random()-0.5)*150,
      life:0.5
    });
  }
}

/* Game logic update */
function update(dt){
  if(!game.running) return;
  game.elapsed += dt;
  game.spawnTimer += dt;
  game.remaining = Math.max(0, game.totalTime - game.elapsed);

  // Increase difficulty every 15s
  const newLevel = Math.floor(game.elapsed/15);
  if(newLevel !== game.difficultyLevel){
    game.difficultyLevel = newLevel;
    game.spawnInterval = Math.max(0.25, 0.5 - 0.05*newLevel);
  }

  // Spawn stars at intervals
  if(game.spawnTimer >= game.spawnInterval){
    game.spawnTimer = 0;
    spawnStar();
  }

  // Move basket based on keys
  if(game.keys.left) game.basket.x -= game.basket.speed*dt;
  if(game.keys.right) game.basket.x += game.basket.speed*dt;
  game.basket.x = clamp(game.basket.x, 6, game.width - game.basket.w - 6);

  // Update stars (falling + catching logic)
  for(let i=game.stars.length-1;i>=0;i--){
    const s = game.stars[i];
    s.y += s.vy*dt;
    s.rot += s.rotSpeed*dt;
    if(checkCatch(s, game.basket)){
      game.stars.splice(i,1);
      game.score++;
      document.getElementById('score').textContent = 'Score: ' + game.score;
      spawnParticles(s.x, s.y);
      continue;
    }
    if(s.y - s.r > game.height) game.stars.splice(i,1);
  }

  // Update particles (fade and move)
  for(let i=game.particles.length-1;i>=0;i--){
    const p = game.particles[i];
    p.x += p.vx*dt;
    p.y += p.vy*dt;
    p.life -= dt;
    if(p.life<=0) game.particles.splice(i,1);
  }

  // Time up
  if(game.elapsed >= game.totalTime) stopGame();
}

/* Detect collision between basket and star */
function checkCatch(star, basket){
  const cx = star.x;
  const cy = star.y + star.r*0.35;
  return cx >= basket.x && cx <= basket.x+basket.w && cy >= basket.y && cy <= basket.y+basket.h+10;
}

/* Render everything on the canvas */
function draw(){
  const ctx = game.ctx;
  ctx.clearRect(0,0,game.width,game.height);

  // Draw stars
  for(const s of game.stars) drawStar(ctx,s);

  // Draw basket
  drawBasket(ctx, game.basket);

  // Draw particles
  ctx.fillStyle = '#ffd84d';
  for(const p of game.particles){
    ctx.globalAlpha = p.life*2;
    ctx.fillRect(p.x, p.y, 3, 3);
    ctx.globalAlpha = 1;
  }

  // Draw timer
  ctx.font = '18px monospace';
  ctx.fillStyle = '#dff6ff';
  ctx.textAlign = 'center';
  ctx.fillText(`Time: ${Math.ceil(game.remaining)}s`, game.width/2, 28);
}

/* Draw a single 5-pointed star */
function drawStar(ctx, s){
  const x=s.x, y=s.y, R=s.r, r=R*0.5;
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(s.rot);
  ctx.beginPath();
  for(let i=0;i<5;i++){
    const a=(i*2)*Math.PI/5 - Math.PI/2;
    ctx.lineTo(Math.cos(a)*R, Math.sin(a)*R);
    const b=(i*2+1)*Math.PI/5 - Math.PI/2;
    ctx.lineTo(Math.cos(b)*r, Math.sin(b)*r);
  }
  ctx.closePath();
  ctx.fillStyle = '#ffd84d';
  ctx.shadowColor = 'rgba(255,220,120,0.9)';
  ctx.shadowBlur = 16;
  ctx.fill();
  ctx.restore();
}

/* Draw basket as simple rectangles */
function drawBasket(ctx,b){
  ctx.fillStyle='#6b3f19';
  ctx.fillRect(b.x, b.y, b.w, b.h);
  ctx.fillStyle='#8a5c2a';
  ctx.fillRect(b.x, b.y-8, b.w, 8);
}

// Kick things off
init();
</script>
</body>
</html>
